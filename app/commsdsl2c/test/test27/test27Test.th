#include "cxxtest/TestSuite.h"

#include "cc_c/test27/Message.h"
#include "cc_c/test27/frame/Frame.h"
#include "cc_c/test27/message/Msg1.h"
#include "cc_c/test27/message/Msg2.h"

#include <cstdint>
#include <cstddef>
#include <memory>

class TestSuite : public CxxTest::TestSuite
{
public:
    void test1();

private:
    struct Deleter
    {
        void operator()(test27_frame_Frame* ptr)
        {
            test27_frame_Frame_free(ptr);
        }

        void operator()(test27_message_Msg1* ptr)
        {
            test27_message_Msg1_free(ptr);
        }        

        void operator()(test27_message_Msg2* ptr)
        {
            test27_message_Msg2_free(ptr);
        }           
    };

    using FramePtr = std::unique_ptr<test27_frame_Frame, Deleter>;    
    using Msg2Ptr = std::unique_ptr<test27_message_Msg2, Deleter>;
};

void TestSuite::test1()
{
    FramePtr frame(test27_frame_Frame_alloc());
    Msg2Ptr msg2(test27_message_Msg2_alloc());

    auto length = test27_frame_Frame_messageLength(frame.get(), test27_message_Msg2_toInterface(msg2.get()));
    std::vector<std::uint8_t> outBuf(length);
    auto bufLen = outBuf.size();
    auto es = test27_frame_Frame_writeMessage(frame.get(), test27_message_Msg2_toInterface(msg2.get()), outBuf.data(), &bufLen);
    TS_ASSERT_EQUALS(es, test27_ErrorStatus_NotSupported);
}
