#include <limits>

#include "CommonTestSuite.h"

#include "commsdsl/parse/ParseFrame.h"

class FrameTestSuite : public CommonTestSuite, public CxxTest::TestSuite
{
public:
    void setUp();
    void tearDown();
    void test1();
    void test2();
    void test3();
    void test4();
    void test5();
    void test6();
    void test7();
    void test8();
    void test9();
    void test10();
    void test11();
    void test12();
    void test13();
    void test14();
    void test15();
    void test16();
    void test17();
    void test18();
    void test19();
    void test20();
    void test21();
    void test22();
    void test23();
    void test24();
};

void FrameTestSuite::setUp()
{
    CommonTestSuite::commonSetUp();
}

void FrameTestSuite::tearDown()
{
    CommonTestSuite::commonTearDown();
}

void FrameTestSuite::test1()
{
    auto protocol = prepareProtocol(SCHEMAS_DIR "/Schema1.xml");
    TS_ASSERT(protocol);

    auto namespaces = protocol->parseLastParsedSchema().parseNamespaces();
    TS_ASSERT_EQUALS(namespaces.size(), 1U);

    auto& ns = namespaces.front();
    TS_ASSERT(ns.parseName().empty());

    auto frames = ns.parseFrames();
    TS_ASSERT_EQUALS(frames.size(), 1U);

    auto& f1 = frames[0];
    TS_ASSERT_EQUALS(f1.parseName(), "Generic");

    auto layers = f1.parseLayers();
    TS_ASSERT_EQUALS(layers.size(), 1U);

    TS_ASSERT_EQUALS(layers.front().parseKind(), commsdsl::parse::ParseLayer::ParseKind::Payload);
    TS_ASSERT(!layers.front().parseHasField());
    TS_ASSERT_EQUALS(layers.front().parseName(), "Data");
}

void FrameTestSuite::test2()
{
    m_status.m_expErrors.push_back(commsdsl::parse::ParseErrorLevel_Error);
    m_status.m_expValidateResult = false;
    auto protocol = prepareProtocol(SCHEMAS_DIR "/Schema2.xml");
    TS_ASSERT(protocol);
}

void FrameTestSuite::test3()
{
    auto protocol = prepareProtocol(SCHEMAS_DIR "/Schema3.xml");
    TS_ASSERT(protocol);

    auto namespaces = protocol->parseLastParsedSchema().parseNamespaces();
    TS_ASSERT_EQUALS(namespaces.size(), 2U);

    auto& gNs = namespaces.front();
    TS_ASSERT(gNs.parseName().empty());

    auto& ns1 = namespaces.back();
    TS_ASSERT_EQUALS(ns1.parseName(), "ns1");

    auto frames = ns1.parseFrames();
    TS_ASSERT_EQUALS(frames.size(), 1U);

    auto& frame1 = frames[0];
    TS_ASSERT_EQUALS(frame1.parseName(), "Generic");

    auto layers = frame1.parseLayers();
    TS_ASSERT_EQUALS(layers.size(), 2U);

    auto& l1 = layers[0];
    auto& l2 = layers[1];

    TS_ASSERT_EQUALS(l1.parseKind(), commsdsl::parse::ParseLayer::ParseKind::Id);
    TS_ASSERT_EQUALS(l1.parseName(), "Id");
    TS_ASSERT(l1.parseHasField());
    auto f1 = l1.parseField();
    TS_ASSERT_EQUALS(f1.parseExternalRef(), "@Schema3.MsgId");

    TS_ASSERT_EQUALS(l2.parseKind(), commsdsl::parse::ParseLayer::ParseKind::Payload);
    TS_ASSERT_EQUALS(l2.parseName(), "Data");
    TS_ASSERT(!l2.parseHasField());
}

void FrameTestSuite::test4()
{
    m_status.m_expErrors.push_back(commsdsl::parse::ParseErrorLevel_Error);
    m_status.m_expValidateResult = false;
    auto protocol = prepareProtocol(SCHEMAS_DIR "/Schema4.xml");
    TS_ASSERT(protocol);
}

void FrameTestSuite::test5()
{
    m_status.m_expErrors.push_back(commsdsl::parse::ParseErrorLevel_Error);
    m_status.m_expValidateResult = false;
    auto protocol = prepareProtocol(SCHEMAS_DIR "/Schema5.xml");
    TS_ASSERT(protocol);
}

void FrameTestSuite::test6()
{
    auto protocol = prepareProtocol(SCHEMAS_DIR "/Schema6.xml");
    TS_ASSERT(protocol);

    auto namespaces = protocol->parseLastParsedSchema().parseNamespaces();
    TS_ASSERT_EQUALS(namespaces.size(), 1U);

    auto& ns = namespaces.front();
    TS_ASSERT_EQUALS(ns.parseName(), "ns1");

    auto frames = ns.parseFrames();
    TS_ASSERT_EQUALS(frames.size(), 1U);

    auto& frame1 = frames[0];
    TS_ASSERT_EQUALS(frame1.parseName(), "Generic");

    auto layers = frame1.parseLayers();
    TS_ASSERT_EQUALS(layers.size(), 3U);

    auto& l1 = layers[0];
    auto& l2 = layers[1];
    auto& l3 = layers[2];

    TS_ASSERT_EQUALS(l1.parseKind(), commsdsl::parse::ParseLayer::ParseKind::Size);
    TS_ASSERT_EQUALS(l1.parseName(), "Size");
    TS_ASSERT(l1.parseHasField());
    auto f1 = l1.parseField();
    TS_ASSERT(f1.parseExternalRef().empty());


    TS_ASSERT_EQUALS(l2.parseKind(), commsdsl::parse::ParseLayer::ParseKind::Id);
    TS_ASSERT_EQUALS(l2.parseName(), "Id");
    TS_ASSERT(l2.parseHasField());
    auto f2 = l2.parseField();
    TS_ASSERT_EQUALS(f2.parseExternalRef(), "@Schema6.ns1.MsgId");

    TS_ASSERT_EQUALS(l3.parseKind(), commsdsl::parse::ParseLayer::ParseKind::Payload);
    TS_ASSERT_EQUALS(l3.parseName(), "Data");
    TS_ASSERT(!l3.parseHasField());
}

void FrameTestSuite::test7()
{
    auto protocol = prepareProtocol(SCHEMAS_DIR "/Schema7.xml");
    TS_ASSERT(protocol);

    auto namespaces = protocol->parseLastParsedSchema().parseNamespaces();
    TS_ASSERT_EQUALS(namespaces.size(), 1U);

    auto& ns = namespaces.front();
    TS_ASSERT_EQUALS(ns.parseName(), "ns1");

    auto frames = ns.parseFrames();
    TS_ASSERT_EQUALS(frames.size(), 1U);

    auto& frame1 = frames[0];
    TS_ASSERT_EQUALS(frame1.parseName(), "Generic");

    auto layers = frame1.parseLayers();
    TS_ASSERT_EQUALS(layers.size(), 4U);

    auto& l1 = layers[0];
    auto& l2 = layers[1];
    auto& l3 = layers[2];
    auto& l4 = layers[3];

    TS_ASSERT_EQUALS(l1.parseKind(), commsdsl::parse::ParseLayer::ParseKind::Sync);
    TS_ASSERT_EQUALS(l1.parseName(), "Sync");
    TS_ASSERT(l1.parseHasField());
    auto f1 = l1.parseField();
    TS_ASSERT_EQUALS(f1.parseExternalRef(), "@Schema7.ns1.Sync");

    TS_ASSERT_EQUALS(l2.parseKind(), commsdsl::parse::ParseLayer::ParseKind::Id);
    TS_ASSERT_EQUALS(l2.parseName(), "Id");
    TS_ASSERT(l2.parseHasField());
    auto f2 = l2.parseField();
    TS_ASSERT_EQUALS(f2.parseExternalRef(false), "ns1.MsgId");

    TS_ASSERT_EQUALS(l3.parseKind(), commsdsl::parse::ParseLayer::ParseKind::Size);
    TS_ASSERT_EQUALS(l3.parseName(), "Size");
    TS_ASSERT(l3.parseHasField());
    auto f3 = l3.parseField();
    TS_ASSERT(f3.parseExternalRef().empty());

    TS_ASSERT_EQUALS(l4.parseKind(), commsdsl::parse::ParseLayer::ParseKind::Payload);
    TS_ASSERT_EQUALS(l4.parseName(), "Data");
    TS_ASSERT(!l4.parseHasField());
}

void FrameTestSuite::test8()
{
    auto protocol = prepareProtocol(SCHEMAS_DIR "/Schema8.xml");
    TS_ASSERT(protocol);

    auto namespaces = protocol->parseLastParsedSchema().parseNamespaces();
    TS_ASSERT_EQUALS(namespaces.size(), 1U);

    auto& ns = namespaces.front();
    TS_ASSERT_EQUALS(ns.parseName(), "ns1");

    auto frames = ns.parseFrames();
    TS_ASSERT_EQUALS(frames.size(), 1U);

    auto& frame1 = frames[0];
    TS_ASSERT_EQUALS(frame1.parseName(), "Generic");

    auto layers = frame1.parseLayers();
    TS_ASSERT_EQUALS(layers.size(), 5U);

    auto& l1 = layers[0];
    auto& l2 = layers[1];
    auto& l3 = layers[2];
    auto& l4 = layers[3];
    auto& l5 = layers[4];

    TS_ASSERT_EQUALS(l1.parseKind(), commsdsl::parse::ParseLayer::ParseKind::Sync);
    TS_ASSERT_EQUALS(l1.parseName(), "Sync");
    TS_ASSERT(l1.parseHasField());
    auto f1 = l1.parseField();
    TS_ASSERT_EQUALS(f1.parseExternalRef(false), "ns1.Sync");

    TS_ASSERT_EQUALS(l2.parseKind(), commsdsl::parse::ParseLayer::ParseKind::Size);
    TS_ASSERT_EQUALS(l2.parseName(), "Size");
    TS_ASSERT(l2.parseHasField());
    auto f2 = l2.parseField();
    TS_ASSERT(f2.parseExternalRef().empty());

    TS_ASSERT_EQUALS(l3.parseKind(), commsdsl::parse::ParseLayer::ParseKind::Id);
    TS_ASSERT_EQUALS(l3.parseName(), "Id");
    TS_ASSERT(l3.parseHasField());
    auto f3 = l3.parseField();
    TS_ASSERT_EQUALS(f3.parseExternalRef(), "@Schema8.ns1.MsgId");

    TS_ASSERT_EQUALS(l4.parseKind(), commsdsl::parse::ParseLayer::ParseKind::Payload);
    TS_ASSERT_EQUALS(l4.parseName(), "Data");
    TS_ASSERT(!l4.parseHasField());

    TS_ASSERT_EQUALS(l5.parseKind(), commsdsl::parse::ParseLayer::ParseKind::Checksum);
    TS_ASSERT_EQUALS(l5.parseName(), "Checksum");
    TS_ASSERT(l5.parseHasField());
    auto f5 = l5.parseField();
    TS_ASSERT(f5.parseExternalRef().empty());
    commsdsl::parse::ParseChecksumLayer checksum(l5);
    TS_ASSERT_EQUALS(checksum.parseAlg(), commsdsl::parse::ParseChecksumLayer::ParseAlg::Crc_CCITT);
    TS_ASSERT_EQUALS(checksum.parseFromLayer(), l2.parseName());
    TS_ASSERT(checksum.parseUntilLayer().empty());
    TS_ASSERT(!checksum.parseVerifyBeforeRead());
}

void FrameTestSuite::test9()
{
    auto protocol = prepareProtocol(SCHEMAS_DIR "/Schema9.xml");
    TS_ASSERT(protocol);

    auto namespaces = protocol->parseLastParsedSchema().parseNamespaces();
    TS_ASSERT_EQUALS(namespaces.size(), 1U);

    auto& ns = namespaces.front();
    TS_ASSERT_EQUALS(ns.parseName(), "ns1");

    auto frames = ns.parseFrames();
    TS_ASSERT_EQUALS(frames.size(), 1U);

    auto& frame1 = frames[0];
    TS_ASSERT_EQUALS(frame1.parseName(), "Generic");

    auto layers = frame1.parseLayers();
    TS_ASSERT_EQUALS(layers.size(), 5U);

    auto& l1 = layers[0];
    auto& l2 = layers[1];
    auto& l3 = layers[2];
    auto& l4 = layers[3];
    auto& l5 = layers[4];

    TS_ASSERT_EQUALS(l1.parseKind(), commsdsl::parse::ParseLayer::ParseKind::Sync);
    TS_ASSERT_EQUALS(l1.parseName(), "Sync");
    TS_ASSERT(l1.parseHasField());
    auto f1 = l1.parseField();
    TS_ASSERT_EQUALS(f1.parseExternalRef(false), "ns1.Sync");

    TS_ASSERT_EQUALS(l2.parseKind(), commsdsl::parse::ParseLayer::ParseKind::Size);
    TS_ASSERT_EQUALS(l2.parseName(), "Size");
    TS_ASSERT(l2.parseHasField());
    auto f2 = l2.parseField();
    TS_ASSERT(f2.parseExternalRef().empty());

    TS_ASSERT_EQUALS(l3.parseKind(), commsdsl::parse::ParseLayer::ParseKind::Checksum);
    TS_ASSERT_EQUALS(l3.parseName(), "Checksum");
    TS_ASSERT(l3.parseHasField());
    auto f3 = l3.parseField();
    TS_ASSERT(f3.parseExternalRef().empty());
    commsdsl::parse::ParseChecksumLayer checksum(l3);
    TS_ASSERT_EQUALS(checksum.parseAlg(), commsdsl::parse::ParseChecksumLayer::ParseAlg::Custom);
    TS_ASSERT_EQUALS(checksum.parseCustomAlgName(), "MyAlg");
    TS_ASSERT(checksum.parseFromLayer().empty());
    TS_ASSERT_EQUALS(checksum.parseUntilLayer(), l5.parseName());
    TS_ASSERT(checksum.parseVerifyBeforeRead());

    TS_ASSERT_EQUALS(l4.parseKind(), commsdsl::parse::ParseLayer::ParseKind::Id);
    TS_ASSERT_EQUALS(l4.parseName(), "Id");
    TS_ASSERT(l4.parseHasField());
    auto f4 = l4.parseField();
    TS_ASSERT_EQUALS(f4.parseExternalRef(false), "ns1.MsgId");

    TS_ASSERT_EQUALS(l5.parseKind(), commsdsl::parse::ParseLayer::ParseKind::Payload);
    TS_ASSERT_EQUALS(l5.parseName(), "Data");
    TS_ASSERT(!l5.parseHasField());
}

void FrameTestSuite::test10()
{
    m_status.m_expErrors.push_back(commsdsl::parse::ParseErrorLevel_Error);
    m_status.m_expValidateResult = false;
    auto protocol = prepareProtocol(SCHEMAS_DIR "/Schema10.xml");
    TS_ASSERT(protocol);
}

void FrameTestSuite::test11()
{
    m_status.m_expErrors.push_back(commsdsl::parse::ParseErrorLevel_Error);
    m_status.m_expValidateResult = false;
    auto protocol = prepareProtocol(SCHEMAS_DIR "/Schema11.xml");
    TS_ASSERT(protocol);
}

void FrameTestSuite::test12()
{
    m_status.m_expErrors.push_back(commsdsl::parse::ParseErrorLevel_Error);
    m_status.m_expValidateResult = false;
    auto protocol = prepareProtocol(SCHEMAS_DIR "/Schema12.xml");
    TS_ASSERT(protocol);
}

void FrameTestSuite::test13()
{
    m_status.m_expErrors.push_back(commsdsl::parse::ParseErrorLevel_Error);
    m_status.m_expValidateResult = false;
    auto protocol = prepareProtocol(SCHEMAS_DIR "/Schema13.xml");
    TS_ASSERT(protocol);
}

void FrameTestSuite::test14()
{
    m_status.m_expErrors.push_back(commsdsl::parse::ParseErrorLevel_Error);
    m_status.m_expValidateResult = false;
    auto protocol = prepareProtocol(SCHEMAS_DIR "/Schema14.xml");
    TS_ASSERT(protocol);
}

void FrameTestSuite::test15()
{
    auto protocol = prepareProtocol(SCHEMAS_DIR "/Schema15.xml");
    TS_ASSERT(protocol);

    auto namespaces = protocol->parseLastParsedSchema().parseNamespaces();
    TS_ASSERT_EQUALS(namespaces.size(), 1U);

    auto& ns = namespaces.front();
    TS_ASSERT_EQUALS(ns.parseName(), "ns1");

    auto frames = ns.parseFrames();
    TS_ASSERT_EQUALS(frames.size(), 1U);

    auto& frame1 = frames[0];
    TS_ASSERT_EQUALS(frame1.parseName(), "Generic");

    auto layers = frame1.parseLayers();
    TS_ASSERT_EQUALS(layers.size(), 3U);

    auto& l2 = layers[1];

    TS_ASSERT_EQUALS(l2.parseKind(), commsdsl::parse::ParseLayer::ParseKind::Value);
    TS_ASSERT_EQUALS(l2.parseName(), "Version");
    TS_ASSERT(l2.parseHasField());
    auto f2 = l2.parseField();
    TS_ASSERT_EQUALS(f2.parseExternalRef(false), "ns1.Version");
    commsdsl::parse::ParseValueLayer valueLayer(l2);
    auto interfaces = valueLayer.parseInterfaces();
    TS_ASSERT_EQUALS(interfaces.size(), 1U);
    TS_ASSERT_EQUALS(interfaces.front().parseExternalRef(), "@Schema15.ns1.Message");
    TS_ASSERT_EQUALS(valueLayer.parseFieldIdx(), 0U);
    TS_ASSERT(!valueLayer.parsePseudo());
}

void FrameTestSuite::test16()
{
    m_status.m_expErrors.push_back(commsdsl::parse::ParseErrorLevel_Error);
    m_status.m_expValidateResult = false;
    auto protocol = prepareProtocol(SCHEMAS_DIR "/Schema16.xml");
    TS_ASSERT(protocol);
}

void FrameTestSuite::test17()
{
    auto protocol = prepareProtocol(SCHEMAS_DIR "/Schema17.xml");
    TS_ASSERT(protocol);

    auto namespaces = protocol->parseLastParsedSchema().parseNamespaces();
    TS_ASSERT_EQUALS(namespaces.size(), 1U);

    auto& ns = namespaces.front();
    TS_ASSERT_EQUALS(ns.parseName(), "ns1");

    auto frames = ns.parseFrames();
    TS_ASSERT_EQUALS(frames.size(), 1U);

    auto& frame1 = frames[0];
    TS_ASSERT_EQUALS(frame1.parseName(), "Generic");

    auto layers = frame1.parseLayers();
    TS_ASSERT_EQUALS(layers.size(), 3U);

    auto& l2 = layers[1];

    TS_ASSERT_EQUALS(l2.parseKind(), commsdsl::parse::ParseLayer::ParseKind::Value);
    TS_ASSERT_EQUALS(l2.parseName(), "Version");
    TS_ASSERT(l2.parseHasField());
    auto f2 = l2.parseField();
    TS_ASSERT_EQUALS(f2.parseExternalRef(false), "ns1.Version");
    commsdsl::parse::ParseValueLayer valueLayer(l2);
    auto interfaces = valueLayer.parseInterfaces();
    TS_ASSERT_EQUALS(interfaces.size(), 1U);
    TS_ASSERT_EQUALS(interfaces.front().parseExternalRef(), "@Schema17.ns1.Message");
    TS_ASSERT_EQUALS(valueLayer.parseFieldIdx(), 0U);
    TS_ASSERT(valueLayer.parsePseudo());
}

void FrameTestSuite::test18()
{
    m_status.m_expErrors.push_back(commsdsl::parse::ParseErrorLevel_Error);
    m_status.m_expValidateResult = false;
    auto protocol = prepareProtocol(SCHEMAS_DIR "/Schema18.xml");
    TS_ASSERT(protocol);
}

void FrameTestSuite::test19()
{
    auto protocol = prepareProtocol(SCHEMAS_DIR "/Schema19.xml");
    TS_ASSERT(protocol);

    auto namespaces = protocol->parseLastParsedSchema().parseNamespaces();
    TS_ASSERT_EQUALS(namespaces.size(), 1U);

    auto& ns1 = namespaces.front();
    TS_ASSERT_EQUALS(ns1.parseName(), "ns1");

    auto frames = ns1.parseFrames();
    TS_ASSERT_EQUALS(frames.size(), 1U);

    auto& frame1 = frames[0];
    TS_ASSERT_EQUALS(frame1.parseName(), "Generic");

    auto layers = frame1.parseLayers();
    TS_ASSERT_EQUALS(layers.size(), 2U);

    auto& l1 = layers[0];
    auto& l2 = layers[1];

    TS_ASSERT_EQUALS(l1.parseKind(), commsdsl::parse::ParseLayer::ParseKind::Custom);
    TS_ASSERT_EQUALS(l1.parseName(), "Header");
    TS_ASSERT(l1.parseHasField());
    auto f1 = l1.parseField();
    TS_ASSERT(f1.parseExternalRef().empty());
    TS_ASSERT_EQUALS(f1.parseKind(), commsdsl::parse::ParseField::ParseKind::Bundle);

    TS_ASSERT_EQUALS(l2.parseKind(), commsdsl::parse::ParseLayer::ParseKind::Payload);
    TS_ASSERT_EQUALS(l2.parseName(), "Data");
    TS_ASSERT(!l2.parseHasField());
}

void FrameTestSuite::test20()
{
    m_status.m_expErrors.push_back(commsdsl::parse::ParseErrorLevel_Warning);
    m_status.m_expErrors.push_back(commsdsl::parse::ParseErrorLevel_Warning);
    auto protocol = prepareProtocol(SCHEMAS_DIR "/Schema20.xml");
    TS_ASSERT(protocol);
}

void FrameTestSuite::test21()
{
    auto protocol = prepareProtocol(SCHEMAS_DIR "/Schema21.xml");
    TS_ASSERT(protocol);

    auto namespaces = protocol->parseLastParsedSchema().parseNamespaces();
    TS_ASSERT_EQUALS(namespaces.size(), 1U);

    auto& ns = namespaces.front();
    TS_ASSERT_EQUALS(ns.parseName(), "ns1");

    auto frames = ns.parseFrames();
    TS_ASSERT_EQUALS(frames.size(), 1U);

    auto& frame1 = frames[0];
    TS_ASSERT_EQUALS(frame1.parseName(), "Generic");

    auto layers = frame1.parseLayers();
    TS_ASSERT_EQUALS(layers.size(), 5U);

    auto& l1 = layers[0];
    auto& l2 = layers[1];
    auto& l3 = layers[2];
    auto& l4 = layers[3];
    auto& l5 = layers[4];

    TS_ASSERT_EQUALS(l1.parseKind(), commsdsl::parse::ParseLayer::ParseKind::Sync);
    TS_ASSERT_EQUALS(l1.parseName(), "Sync");
    TS_ASSERT(l1.parseHasField());
    auto f1 = l1.parseField();
    TS_ASSERT_EQUALS(f1.parseExternalRef(false), "ns1.Sync");

    TS_ASSERT_EQUALS(l2.parseKind(), commsdsl::parse::ParseLayer::ParseKind::Size);
    TS_ASSERT_EQUALS(l2.parseName(), "Size");
    TS_ASSERT(l2.parseHasField());
    auto f2 = l2.parseField();
    TS_ASSERT(f2.parseExternalRef().empty());

    TS_ASSERT_EQUALS(l3.parseKind(), commsdsl::parse::ParseLayer::ParseKind::Id);
    TS_ASSERT_EQUALS(l3.parseName(), "Id");
    TS_ASSERT(l3.parseHasField());
    auto f3 = l3.parseField();
    TS_ASSERT_EQUALS(f3.parseExternalRef(false), "ns1.MsgId");

    TS_ASSERT_EQUALS(l4.parseKind(), commsdsl::parse::ParseLayer::ParseKind::Payload);
    TS_ASSERT_EQUALS(l4.parseName(), "Data");
    TS_ASSERT(!l4.parseHasField());

    TS_ASSERT_EQUALS(l5.parseKind(), commsdsl::parse::ParseLayer::ParseKind::Custom);
    TS_ASSERT_EQUALS(l5.parseName(), "Checksum");
    TS_ASSERT(l5.parseHasField());
    auto f5 = l5.parseField();
    TS_ASSERT(f5.parseExternalRef().empty());
    commsdsl::parse::ParseCustomLayer checksum(l5);
    TS_ASSERT_EQUALS(checksum.parseSemanticLayerType(), commsdsl::parse::ParseLayer::ParseKind::Checksum);
    TS_ASSERT_EQUALS(checksum.parseChecksumFromLayer(), l2.parseName());
    TS_ASSERT(checksum.parseChecksumUntilLayer().empty());
}

void FrameTestSuite::test22()
{
    m_status.m_expErrors.push_back(commsdsl::parse::ParseErrorLevel_Error);
    m_status.m_expValidateResult = false;
    auto protocol = prepareProtocol(SCHEMAS_DIR "/Schema22.xml");
    TS_ASSERT(protocol);
}

void FrameTestSuite::test23()
{
    auto protocol = prepareProtocol(SCHEMAS_DIR "/Schema23.xml");
    TS_ASSERT(protocol);

    auto namespaces = protocol->parseLastParsedSchema().parseNamespaces();
    TS_ASSERT_EQUALS(namespaces.size(), 1U);

    auto& ns = namespaces.front();
    TS_ASSERT(ns.parseName().empty());

    auto frames = ns.parseFrames();
    TS_ASSERT_EQUALS(frames.size(), 1U);

    auto& f1 = frames[0];
    TS_ASSERT_EQUALS(f1.parseName(), "Frame");
    TS_ASSERT_EQUALS(f1.parseDisplayName(), "Some Frame");
}

void FrameTestSuite::test24()
{
    m_status.m_expErrors.push_back(commsdsl::parse::ParseErrorLevel_Warning);
    auto protocol = prepareProtocol(SCHEMAS_DIR "/Schema24.xml");
    TS_ASSERT(protocol);
}